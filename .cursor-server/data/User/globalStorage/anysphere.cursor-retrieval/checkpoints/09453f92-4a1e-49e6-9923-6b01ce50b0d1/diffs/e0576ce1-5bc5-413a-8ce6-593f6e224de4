{"fsPath":"/root/itsbot/main_fast.py","fileUuid":"e0576ce1-5bc5-413a-8ce6-593f6e224de4","fileSizeBytes":11826,"numLines":296,"diffChanges":[{"originalStartLineNumberOneIndexed":3,"originalEndLineNumberExclusiveOneIndexed":3,"modifiedStartLineNumberOneIndexed":3,"modifiedEndLineNumberExclusiveOneIndexed":4,"addedLines":["# Anti-detection: randomized timing, rotating user agents, human-like patterns"],"tokenizedAddedLines":[1000195]},{"originalStartLineNumberOneIndexed":8,"originalEndLineNumberExclusiveOneIndexed":8,"modifiedStartLineNumberOneIndexed":9,"modifiedEndLineNumberExclusiveOneIndexed":11,"addedLines":["import random","import hashlib"],"tokenizedAddedLines":[1000196,1000197]},{"originalStartLineNumberOneIndexed":27,"originalEndLineNumberExclusiveOneIndexed":28,"modifiedStartLineNumberOneIndexed":30,"modifiedEndLineNumberExclusiveOneIndexed":45,"addedLines":["# Rotating user agents to avoid detection","USER_AGENTS = [","    \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","    \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36\",","    \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\",","    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36\",","    \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","    \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0\",","    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15\",","]","","def get_random_headers():","    \"\"\"Generate randomized headers to avoid detection\"\"\"","    return {"],"tokenizedAddedLines":[1000198,1000199,1000200,1000201,1000202,1000203,1000204,1000205,1000206,1000207,18,8,1000208,1000209,1000210]},{"originalStartLineNumberOneIndexed":30,"originalEndLineNumberExclusiveOneIndexed":30,"modifiedStartLineNumberOneIndexed":47,"modifiedEndLineNumberExclusiveOneIndexed":52,"addedLines":["        \"accept-language\": random.choice([","            \"en-US,en;q=0.9\",","            \"en-GB,en;q=0.9,en-US;q=0.8\",","            \"en-US,en;q=0.9,es;q=0.8\",","        ]),"],"tokenizedAddedLines":[1000211,1000212,1000213,1000214,1000215]},{"originalStartLineNumberOneIndexed":33,"originalEndLineNumberExclusiveOneIndexed":34,"modifiedStartLineNumberOneIndexed":55,"modifiedEndLineNumberExclusiveOneIndexed":64,"addedLines":["        \"user-agent\": random.choice(USER_AGENTS),","        \"sec-ch-ua\": f'\"Chromium\";v=\"{random.randint(118, 122)}\", \"Not_A Brand\";v=\"8\"',","        \"sec-ch-ua-mobile\": \"?0\",","        \"sec-ch-ua-platform\": random.choice(['\"Windows\"', '\"macOS\"', '\"Linux\"']),","        \"sec-fetch-dest\": \"empty\",","        \"sec-fetch-mode\": \"cors\",","        \"sec-fetch-site\": \"same-origin\",","        \"cache-control\": \"no-cache\",","        \"pragma\": \"no-cache\","],"tokenizedAddedLines":[1000216,1000217,1000218,1000219,1000220,1000221,1000222,1000223,1000224]},{"originalStartLineNumberOneIndexed":37,"originalEndLineNumberExclusiveOneIndexed":38,"modifiedStartLineNumberOneIndexed":67,"modifiedEndLineNumberExclusiveOneIndexed":69,"addedLines":["BURST_ATTEMPTS_MIN = 7  # Minimum concurrent attempts","BURST_ATTEMPTS_MAX = 12  # Maximum concurrent attempts (randomized)"],"tokenizedAddedLines":[1000225,1000226]},{"originalStartLineNumberOneIndexed":42,"originalEndLineNumberExclusiveOneIndexed":44,"modifiedStartLineNumberOneIndexed":73,"modifiedEndLineNumberExclusiveOneIndexed":75,"addedLines":["def in_burst_window(now_utc: datetime.datetime, random_offset: int = 0) -> bool:","    \"\"\"More aggressive burst window for FCFS with randomization\"\"\""],"tokenizedAddedLines":[1000227,1000228]},{"originalStartLineNumberOneIndexed":48,"originalEndLineNumberExclusiveOneIndexed":50,"modifiedStartLineNumberOneIndexed":79,"modifiedEndLineNumberExclusiveOneIndexed":84,"addedLines":["    # Randomized start time between 59:57 and 59:59 to avoid detection","    burst_start = 58 + random_offset","    ","    # Start earlier with randomization","    if m == 59 and s >= burst_start:"],"tokenizedAddedLines":[1000229,1000230,39,1000231,1000232]},{"originalStartLineNumberOneIndexed":97,"originalEndLineNumberExclusiveOneIndexed":98,"modifiedStartLineNumberOneIndexed":131,"modifiedEndLineNumberExclusiveOneIndexed":135,"addedLines":["    \"\"\"Send a single claim request with anti-detection measures\"\"\"","    # Add random delay to make requests less uniform (0-50ms jitter)","    await asyncio.sleep(random.uniform(0, 0.05))","    "],"tokenizedAddedLines":[1000233,1000234,1000235,39]},{"originalStartLineNumberOneIndexed":104,"originalEndLineNumberExclusiveOneIndexed":104,"modifiedStartLineNumberOneIndexed":141,"modifiedEndLineNumberExclusiveOneIndexed":145,"addedLines":["    ","    # Use randomized headers for each request","    headers = get_random_headers()","    "],"tokenizedAddedLines":[39,1000236,1000237,39]},{"originalStartLineNumberOneIndexed":108,"originalEndLineNumberExclusiveOneIndexed":109,"modifiedStartLineNumberOneIndexed":149,"modifiedEndLineNumberExclusiveOneIndexed":150,"addedLines":["            headers=headers,"],"tokenizedAddedLines":[1000238]},{"originalStartLineNumberOneIndexed":129,"originalEndLineNumberExclusiveOneIndexed":130,"modifiedStartLineNumberOneIndexed":170,"modifiedEndLineNumberExclusiveOneIndexed":174,"addedLines":["    \"\"\"Send multiple concurrent requests with randomization to avoid detection\"\"\"","    # Randomize number of attempts to avoid predictable patterns","    num_attempts = random.randint(BURST_ATTEMPTS_MIN, BURST_ATTEMPTS_MAX)","    "],"tokenizedAddedLines":[1000239,1000240,1000241,39]},{"originalStartLineNumberOneIndexed":131,"originalEndLineNumberExclusiveOneIndexed":132,"modifiedStartLineNumberOneIndexed":175,"modifiedEndLineNumberExclusiveOneIndexed":176,"addedLines":["    for i in range(num_attempts):"],"tokenizedAddedLines":[1000242]},{"originalStartLineNumberOneIndexed":134,"originalEndLineNumberExclusiveOneIndexed":137,"modifiedStartLineNumberOneIndexed":178,"modifiedEndLineNumberExclusiveOneIndexed":181,"addedLines":["        # Randomized stagger between launches (0.5-2ms) to avoid detection","        if i < num_attempts - 1:","            await asyncio.sleep(random.uniform(0.0005, 0.002))"],"tokenizedAddedLines":[1000243,1000244,1000245]},{"originalStartLineNumberOneIndexed":154,"originalEndLineNumberExclusiveOneIndexed":154,"modifiedStartLineNumberOneIndexed":198,"modifiedEndLineNumberExclusiveOneIndexed":200,"addedLines":["        # Use randomized headers for warmup too","        headers = get_random_headers()"],"tokenizedAddedLines":[1000246,1000247]},{"originalStartLineNumberOneIndexed":156,"originalEndLineNumberExclusiveOneIndexed":157,"modifiedStartLineNumberOneIndexed":202,"modifiedEndLineNumberExclusiveOneIndexed":203,"addedLines":["            headers=headers,"],"tokenizedAddedLines":[1000238]},{"originalStartLineNumberOneIndexed":166,"originalEndLineNumberExclusiveOneIndexed":167,"modifiedStartLineNumberOneIndexed":212,"modifiedEndLineNumberExclusiveOneIndexed":213,"addedLines":["    \"\"\"Main async loop with speed optimizations and anti-detection\"\"\""],"tokenizedAddedLines":[1000248]},{"originalStartLineNumberOneIndexed":168,"originalEndLineNumberExclusiveOneIndexed":168,"modifiedStartLineNumberOneIndexed":214,"modifiedEndLineNumberExclusiveOneIndexed":218,"addedLines":["    ","    # Generate a random timing offset for this session (-1 to 1 second)","    # This makes each bot instance slightly different","    timing_offset = random.randint(-1, 1)"],"tokenizedAddedLines":[39,1000249,1000250,1000251]},{"originalStartLineNumberOneIndexed":184,"originalEndLineNumberExclusiveOneIndexed":184,"modifiedStartLineNumberOneIndexed":234,"modifiedEndLineNumberExclusiveOneIndexed":235,"addedLines":["        print(f\"ðŸŽ­ Anti-detection: Randomized timing, rotating user agents\")"],"tokenizedAddedLines":[1000252]},{"originalStartLineNumberOneIndexed":188,"originalEndLineNumberExclusiveOneIndexed":188,"modifiedStartLineNumberOneIndexed":239,"modifiedEndLineNumberExclusiveOneIndexed":240,"addedLines":["        print(f\"â±ï¸  Timing offset: {timing_offset}s (unique per session)\")"],"tokenizedAddedLines":[1000253]},{"originalStartLineNumberOneIndexed":195,"originalEndLineNumberExclusiveOneIndexed":197,"modifiedStartLineNumberOneIndexed":247,"modifiedEndLineNumberExclusiveOneIndexed":250,"addedLines":["            # (1) Connection warming - with randomized timing","            warmup_start = 50 + random.randint(-2, 2)  # 48-52 seconds","            if utc_minute == 59 and warmup_start <= utc_second <= 57:"],"tokenizedAddedLines":[1000254,1000255,1000256]},{"originalStartLineNumberOneIndexed":199,"originalEndLineNumberExclusiveOneIndexed":205,"modifiedStartLineNumberOneIndexed":252,"modifiedEndLineNumberExclusiveOneIndexed":258,"addedLines":["                    # Warm multiple times with random delays","                    await warm_connection(session)","                    await asyncio.sleep(random.uniform(0.1, 0.3))","                    await warm_connection(session)","                    await asyncio.sleep(random.uniform(0.1, 0.3))","                    await warm_connection(session)"],"tokenizedAddedLines":[1000257,1000258,1000259,1000258,1000259,1000258]},{"originalStartLineNumberOneIndexed":207,"originalEndLineNumberExclusiveOneIndexed":209,"modifiedStartLineNumberOneIndexed":260,"modifiedEndLineNumberExclusiveOneIndexed":262,"addedLines":["            # (2) Burst attack window with randomization","            if in_burst_window(now_utc, timing_offset):"],"tokenizedAddedLines":[1000260,1000261]},{"originalStartLineNumberOneIndexed":227,"originalEndLineNumberExclusiveOneIndexed":229,"modifiedStartLineNumberOneIndexed":280,"modifiedEndLineNumberExclusiveOneIndexed":282,"addedLines":["                # Randomized sleep during burst window (40-60ms)","                await asyncio.sleep(random.uniform(0.04, 0.06))"],"tokenizedAddedLines":[1000262,1000263]},{"originalStartLineNumberOneIndexed":231,"originalEndLineNumberExclusiveOneIndexed":233,"modifiedStartLineNumberOneIndexed":284,"modifiedEndLineNumberExclusiveOneIndexed":286,"addedLines":["            # (3) Randomized sleep during waiting period (80-120ms)","            await asyncio.sleep(random.uniform(0.08, 0.12))"],"tokenizedAddedLines":[1000264,1000265]}],"gitInfo":{"gitInfo":{"gitRoot":"/root/itsbot","branch":"main","commitHash":"e659b0e2194cfc098e10bc80ee7d41ca763e1db8"}},"kind":"KIND_MODIFIED"}